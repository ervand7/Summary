–í–æ—Ç —Ç—ã —Å–∫–∞–∑–∞–ª –ø—Ä–æ —Ç—Ä–µ—Ö—Ü–≤–µ—Ç–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º, –∞ –Ω–µ–ª—å–∑—è –±—ã–ª–æ –ø—Ä–æ—Å—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—å
–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Å—ã–ª–æ–∫ –Ω–∞ –æ–±—ä–µ–∫—Ç –∏ –ø–æ —Ñ–∞–∫—Ç—É –µ—Å–ª–∏ —Ç—ã —É–¥–∞–ª—è–µ—à—å –∫–∞–∫–æ–π-—Ç–æ –æ–±—ä–µ–∫—Ç,
–∫–æ—Ç–æ—Ä—ã–π —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –¥—Ä—É–≥–æ–π, —Ç—ã —É–º–µ–Ω—å—à–∞–µ—à—å —Å—á–µ—Ç—á–∏–∫, –∏ –≤ –∫–æ–Ω—Ü–µ —Ç—ã –ø—Ä–æ—Å—Ç–æ
—Å–º–æ—Ç—Ä–∏—à—å –µ—Å–ª–∏ —Å—Å—ã–ª–∞–µ—Ç—Å—è 0 –¥—Ä—É–≥–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç–æ —É–¥–∞–ª—è—Ç—å?

Reference counting (–ø–æ–¥—Å—á—ë—Ç —Å—Å—ã–ª–æ–∫) ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Å–±–æ—Ä–∫–µ –º—É—Å–æ—Ä–∞.
–û–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —è–∑—ã–∫–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ Python –∏ Swift),
–Ω–æ —É –Ω–µ–≥–æ –µ—Å—Ç—å –≤–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –∏–∑-–∑–∞ –∫–æ—Ç–æ—Ä—ã—Ö Go –≤—ã–±—Ä–∞–ª —Ç—Ä–∏—Ü–≤–µ—Ç–Ω—ã–π (mark-and-sweep)
–∞–ª–≥–æ—Ä–∏—Ç–º –≤–º–µ—Å—Ç–æ –Ω–µ–≥–æ.

## üì¶ –ß—Ç–æ —Ç–∞–∫–æ–µ reference counting?
> –£ –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –µ—Å—Ç—å —Å—á—ë—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫ (refcount) ‚Äî —Å–∫–æ–ª—å–∫–æ –¥—Ä—É–≥–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤/–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
–Ω–∞ –Ω–µ–≥–æ —Å—Å—ã–ª–∞—é—Ç—Å—è.

* –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å—Å—ã–ª–∫–∞ ‚Üí —Å—á—ë—Ç—á–∏–∫ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è
* –ö–æ–≥–¥–∞ —Å—Å—ã–ª–∫–∞ —É–¥–∞–ª—è–µ—Ç—Å—è ‚Üí —Å—á—ë—Ç—á–∏–∫ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è
* –ï—Å–ª–∏ —Å—á—ë—Ç—á–∏–∫ = 0 ‚Üí –æ–±—ä–µ–∫—Ç –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å


## üß® –ü–æ—á–µ–º—É Go –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç reference counting

### ‚ùå 1. **–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è**
```go
type Node struct {
	next *Node
}

a := &Node{}
b := &Node{}
a.next = b
b.next = a
```

–û–Ω–∏ **—Å—Å—ã–ª–∞—é—Ç—Å—è –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞**, –Ω–æ **–±–æ–ª—å—à–µ –Ω–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è**.
**–°—á—ë—Ç—á–∏–∫–∏ ‚â† 0**, –∏ **GC –Ω–µ —É–¥–∞–ª–∏—Ç** –∏—Ö.

‚û°Ô∏è –≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ reference counting ‚Äî **–æ–Ω –Ω–µ –≤–∏–¥–∏—Ç "–º–µ—Ä—Ç–≤—ã–µ —Ü–∏–∫–ª—ã"**.


### ‚ùå 2. **–í—ã—Å–æ–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è**

–ö–∞–∂–¥–æ–µ:
```go
x = y
```

—Ç—Ä–µ–±—É–µ—Ç:
* —É–º–µ–Ω—å—à–∏—Ç—å —Å—á—ë—Ç—á–∏–∫ —Å—Ç–∞—Ä–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ (–µ—Å–ª–∏ –±—ã–ª)
* —É–≤–µ–ª–∏—á–∏—Ç—å —Å—á—ë—Ç—á–∏–∫ –Ω–æ–≤–æ–≥–æ

‚û°Ô∏è –≠—Ç–æ –∑–∞–º–µ–¥–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å—Å—ã–ª–æ–∫.


### ‚ùå 3. **–ù–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ stop-the-world**

* Reference counting **–æ—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º**.
* –ê Go —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –Ω–∞ **—Ç—ã—Å—è—á–∏ –≥–æ—Ä—É—Ç–∏–Ω –∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å**.
* –¢—Ä–∏—Ü–≤–µ—Ç–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∑–≤–æ–ª—è–µ—Ç Go GC —Ä–∞–±–æ—Ç–∞—Ç—å **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ**,
–±–µ–∑ –ø–æ–ª–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–∏—Ä–∞.


## ‚úÖ –ü–æ—á–µ–º—É Go –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—Ä—ë—Ö—Ü–≤–µ—Ç–Ω—ã–π mark-and-sweep

1. –£–º–µ–µ—Ç **–Ω–∞—Ö–æ–¥–∏—Ç—å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**
2. **–†–∞–±–æ—Ç–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –ø—Ä–æ–≥—Ä–∞–º–º–æ–π**
3. –ü–æ–∑–≤–æ–ª—è–µ—Ç **–º–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∂–∞—Ç—å CPU** –ø—Ä–∏ –æ–±—ã—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö


## üß† –ï—Å–ª–∏ —É–ø—Ä–æ—Å—Ç–∏—Ç—å:

| –ú–µ—Ç–æ–¥                   | –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ                           | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫                                       |
| ----------------------- | ------------------------------------   | ----------------------------------------------   |
| **Reference counting**  | –ü—Ä–æ—Å—Ç, –±—ã—Å—Ç—Ä—ã–π GC                      | ‚ùå –ù–µ —É–¥–∞–ª—è–µ—Ç —Ü–∏–∫–ª—ã, ‚ùå –º–Ω–æ–≥–æ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π |
| **Mark-and-sweep (Go)** | ‚úÖ –£–¥–∞–ª—è–µ—Ç —Ü–∏–∫–ª—ã, ‚úÖ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –≤ —Ñ–æ–Ω–µ | –°–ª–æ–∂–Ω–µ–µ, —Ç—Ä–µ–±—É–µ—Ç pause time (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π)        |
